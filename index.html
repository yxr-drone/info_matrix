<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æƒ…æŠ¥çŸ©é˜µ | Intelligence Matrix</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-main: #1e293b;
            --text-sub: #64748b;
            --border-color: #e2e8f0;
            --accent-color: #f59e0b;
        }
        
        [data-theme="dark"] {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-main: #f1f5f9;
            --text-sub: #94a3b8;
            --border-color: #334155;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
            transition: background 0.3s;
        }
        
        /* ä¾§è¾¹æ  - æ¡Œé¢ç«¯ */
        .sidebar {
            width: 240px;
            background: #1e293b;
            color: white;
            padding: 20px;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }
        .sidebar h2 { font-size: 1.2rem; margin-bottom: 30px; border-bottom: 1px solid #334155; padding-bottom: 15px; }
        .nav-item {
            padding: 12px 15px;
            margin-bottom: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem;
        }
        .nav-item:hover { background: #334155; }
        .nav-item.active { background: var(--primary-color); }
        
        /* ç§»åŠ¨ç«¯åº•éƒ¨/é¡¶éƒ¨å¯¼èˆªï¼ˆä»…ç§»åŠ¨ç«¯æ˜¾ç¤ºï¼‰ */
        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            width: 100%;
            background: var(--card-bg);
            border-top: 1px solid var(--border-color);
            justify-content: space-around;
            padding: 10px 0;
            z-index: 100;
        }
        .mobile-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 0.7rem;
            color: var(--text-sub);
            gap: 4px;
        }
        .mobile-nav-item.active { color: var(--primary-color); }
        .mobile-nav-item i { font-size: 1.2rem; }

        /* ä¸»å†…å®¹åŒº */
        .main-content {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            padding-bottom: 60px; /* ä¸ºç§»åŠ¨ç«¯å¯¼èˆªç•™ç™½ */
        }
        header {
            padding: 15px 25px;
            background: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .view-controls {
            display: flex;
            background: var(--bg-color);
            padding: 3px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        .view-btn {
            padding: 4px 10px;
            border-radius: 6px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 0.8rem;
            color: var(--text-sub);
        }
        .view-btn.active {
            background: var(--card-bg);
            color: var(--primary-color);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .feed { padding: 20px; max-width: 800px; margin: 0 auto; width: 100%; box-sizing: border-box; }
        
        /* å¡ç‰‡è®¾è®¡ä¼˜åŒ– */
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border: 1px solid var(--border-color);
        }
        .author-tag { font-weight: 700; color: var(--primary-color); font-size: 0.85rem; }
        .date-tag { color: var(--text-sub); font-size: 0.8rem; }
        .title { font-size: 1.25rem; font-weight: 800; margin: 10px 0; color: var(--text-main); line-height: 1.3; }
        .lang-en { font-style: italic; color: var(--text-sub); border-left: 3px solid var(--border-color); padding-left: 12px; margin-bottom: 10px; font-size: 0.95rem; }
        .lang-zh { color: var(--text-main); font-size: 1.05rem; line-height: 1.5; }
        .media-container img { width: 100%; border-radius: 8px; margin-top: 12px; }
        
        .bookmark-btn { cursor: pointer; font-size: 1.2rem; color: #ccc; }
        .bookmark-btn.active { color: var(--accent-color); }

        /* å“åº”å¼æ–­ç‚¹ */
        @media (max-width: 768px) {
            .sidebar { display: none; }
            .mobile-nav { display: flex; }
            header { padding: 10px 15px; }
            #author-title { font-size: 1rem; }
            .feed { padding: 10px; }
            .card { padding: 15px; border-radius: 0; border-left: none; border-right: none; margin-bottom: 15px; }
            .main-content { padding-bottom: 70px; }
        }
    </style>
</head>
<body>
    <!-- æ¡Œé¢ç«¯ä¾§è¾¹æ  -->
    <div class="sidebar">
        <h2>æƒ…æŠ¥çŸ©é˜µ</h2>
        <div class="nav-item active" onclick="switchAuthor('All')">ğŸŒ å…¨éƒ¨æµ</div>
        <div class="nav-item" onclick="switchAuthor('Andrej Karpathy')">ğŸ§  Karpathy</div>
        <div class="nav-item" onclick="switchAuthor('Fei-Fei Li')">ğŸ‘ï¸ æé£é£</div>
        <div class="nav-item" onclick="switchAuthor('Bookmarks')">â­ æ”¶è—å¤¹</div>
    </div>
    
    <!-- ç§»åŠ¨ç«¯åº•éƒ¨å¯¼èˆª -->
    <div class="mobile-nav">
        <div class="mobile-nav-item active" onclick="switchAuthor('All')"><span>ğŸŒ</span>å…¨éƒ¨</div>
        <div class="mobile-nav-item" onclick="switchAuthor('Andrej Karpathy')"><span>ğŸ§ </span>AK</div>
        <div class="mobile-nav-item" onclick="switchAuthor('Fei-Fei Li')"><span>ğŸ‘ï¸</span>æé£é£</div>
        <div class="mobile-nav-item" onclick="switchAuthor('Bookmarks')"><span>â­</span>æ”¶è—</div>
    </div>
    
    <div class="main-content">
        <header>
            <div id="author-title" style="font-weight: 800; color: var(--text-main);">å…¨éƒ¨æƒ…æŠ¥</div>
            <div class="view-controls">
                <button id="view-dual" class="view-btn active" onclick="setViewMode('dual')">å¯¹ç…§</button>
                <button id="view-zh" class="view-btn" onclick="setViewMode('zh')">ä¸­</button>
                <button id="view-en" class="view-btn" onclick="setViewMode('en')">è‹±</button>
            </div>
            <div class="sort-controls" style="display: flex; background: var(--bg-color); padding: 3px; border-radius: 8px; border: 1px solid var(--border-color); gap: 2px;">
                <select id="sort-select" onchange="setSort(this.value)" style="background: none; border: none; color: var(--text-main); font-size: 0.8rem; outline: none; cursor: pointer; padding: 2px 5px;">
                    <option value="latest">ğŸ“… æœ€æ–°å‘å¸ƒ</option>
                    <option value="oldest">â³ æœ€æ—©è¿½æº¯</option>
                    <option value="hot">ğŸ”¥ çƒ­åº¦æ’åº</option>
                </select>
            </div>
            <button onclick="toggleTheme()" style="background: none; border: none; font-size: 1.2rem; cursor: pointer;">ğŸŒ“</button>
        </header>
        
        <div class="feed" id="matrix-feed"></div>
    </div>

    <script src="matrix_data.js"></script>
    <script>
        let currentAuthor = 'All';
        let viewMode = 'dual'; 
        let currentSort = 'latest'; 
        let bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');

        function render() {
            const feed = document.getElementById('matrix-feed');
            let data = [...matrixData];
            
            // 1. è¿‡æ»¤
            let filteredData = data.filter(d => {
                if (currentAuthor === 'Bookmarks') return bookmarks.includes(d.id);
                return (currentAuthor === 'All' || d.author === currentAuthor);
            });

            // 2. æ’åºé€»è¾‘
            if (currentSort === 'latest') {
                filteredData.sort((a, b) => new Date(b.date) - new Date(a.date));
            } else if (currentSort === 'oldest') {
                filteredData.sort((a, b) => new Date(a.date) - new Date(b.date));
            } else if (currentSort === 'hot') {
                filteredData.sort((a, b) => {
                    const getScore = (item) => {
                        let score = item.isHot ? 100 : 0; // æ ¸å¿ƒï¼šæ‰‹åŠ¨ç½®é¡¶æˆ–çƒ­é—¨å†…å®¹ç»™è¶…é«˜åˆ†
                        score += (item.original.length / 50);
                        const daysAgo = (new Date() - new Date(item.date)) / (1000 * 60 * 60 * 24);
                        if (daysAgo < 14) score += 20; 
                        return score;
                    };
                    return getScore(b) - getScore(a);
                });
            }

            feed.innerHTML = filteredData.map(item => {
                const isBookmarked = bookmarks.includes(item.id);
                return `
                <div class="card">
                    <div class="card-header">
                        <span class="author-tag">${item.author}</span>
                        <div style="display: flex; gap: 12px; align-items: center;">
                            ${item.isHot ? '<span style="color: var(--accent-color); font-weight: bold; font-size: 0.8rem; background: rgba(245, 158, 11, 0.1); padding: 2px 6px; border-radius: 4px;">ğŸ”¥ çƒ­é—¨</span>' : ''}
                            <span class="bookmark-btn ${isBookmarked ? 'active' : ''}" onclick="toggleBookmark('${item.id}')">â˜…</span>
                            <span class="date-tag">${item.date}</span>
                        </div>
                    </div>
                    ${item.title ? `<div class="title">${item.title}</div>` : ''}
                    <div class="lang-block">
                        <div class="lang-en" style="margin-bottom: 8px;">${item.original}</div>
                        <div class="lang-zh" style="color: var(--text-main); font-weight: 500; border-left: 3px solid var(--primary-color); padding-left: 12px;">${item.translation || 'ï¼ˆç¿»è¯‘åŒæ­¥ä¸­...ï¼‰'}</div>
                    </div>
                    ${item.media && item.media.length > 0 ? `
                    <div class="media-container"><img src="${item.media[0]}" onerror="this.style.display='none'"></div>
                    ` : ''}
                    <div class="links" style="margin-top: 15px; border-top: 1px solid var(--border-color); padding-top: 12px;">
                        <a href="${item.url}" target="_blank" style="display: inline-flex; align-items: center; gap: 5px; color: var(--primary-color); font-weight: 600; text-decoration: none; font-size: 0.9rem;">ğŸ”— é˜…è¯»åŸæ–‡ <span style="font-size: 0.7rem; opacity: 0.7;">â†’</span></a>
                    </div>
                </div>`;
            }).join('');
        }

        function setViewMode(mode) {
            viewMode = mode;
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`view-${mode}`).classList.add('active');
            render();
        }

        function setSort(mode) {
            currentSort = mode;
            render();
        }

        function toggleBookmark(id) {
            bookmarks = bookmarks.includes(id) ? bookmarks.filter(b => b !== id) : [...bookmarks, id];
            localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
            render();
        }

        function switchAuthor(author) {
            currentAuthor = author;
            // æ›´æ–°å¯¼èˆªçŠ¶æ€
            document.querySelectorAll('.nav-item, .mobile-nav-item').forEach(item => {
                item.classList.toggle('active', item.innerText.includes(author === 'All' ? 'å…¨éƒ¨' : author === 'Bookmarks' ? 'æ”¶è—' : author.split(' ').pop()));
            });
            document.getElementById('author-title').innerText = author === 'All' ? 'å…¨éƒ¨æƒ…æŠ¥' : author === 'Bookmarks' ? 'å·²æ”¶è—' : author;
            render();
            window.scrollTo(0,0);
        }

        function toggleTheme() {
            const isDark = document.body.getAttribute('data-theme') === 'dark';
            document.body.toggleAttribute('data-theme', !isDark);
            localStorage.setItem('theme', !isDark ? 'dark' : 'light');
        }

        window.onload = () => {
            if (localStorage.getItem('theme') === 'dark') document.body.setAttribute('data-theme', 'dark');
            render();
        };
    </script>
</body>
</html>